 <!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ECOMAS - Social Crypto Platform</title>
    <script src="https://unpkg.com/@thirdweb-dev/sdk@3"></script>
    <script src="https://unpkg.com/mongodb@4.5/dist/mongodb.js"></script>
    <script src="https://checkout.flutterwave.com/v3.js"></script>
    <style>
        :root {
            --primary: #4361ee;
            --secondary: #3f37c9;
            --success: #4cc9f0;
            --warning: #f72585;
            --dark: #1d3557;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f8f9fa;
            color: #333;
        }
        header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid var(--primary);
        }
        h1 {
            color: var(--primary);
            margin-bottom: 5px;
        }
        .subtitle {
            color: var(--secondary);
            font-style: italic;
        }
        .card {
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            padding: 20px;
            margin-bottom: 20px;
        }
        button {
            background-color: var(--primary);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: background-color 0.3s;
            margin: 5px;
        }
        button:hover {
            background-color: var(--secondary);
        }
        .miner-badge {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 20px;
            font-weight: bold;
            margin-left: 10px;
        }
        .silver {
            background-color: #c0c0c0;
            color: #333;
        }
        .gold {
            background-color: #ffd700;
            color: #333;
        }
        .power {
            background-color: #4361ee;
            color: white;
        }
        input, select, textarea {
            padding: 10px;
            border-radius: 5px;
            border: 1px solid #ddd;
            width: 100%;
            margin-bottom: 10px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 10px 0;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: var(--primary);
            color: white;
        }
        audio {
            width: 100%;
            margin-top: 10px;
        }
        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <header>
        <h1>ECOMAS</h1>
        <div class="subtitle">Socials powered by MAZOL</div>
    </header>

    <!-- Wallet Connection -->
    <div class="card">
        <button id="connectWalletBtn">Connect Wallet</button>
        <div id="walletStatus">Not connected</div>
        <div id="minerStatus" class="miner-badge silver">ðŸ¥ˆ Silver Miner</div>
    </div>

    <!-- Mining Dashboard -->
    <div class="card">
        <h2>Mining Dashboard</h2>
        <div class="mining-stats">
            <div>Mining Rate: <span id="miningRate">0.01</span> MZLx/min</div>
            <div>Mined Tokens: <span id="minedTokens">0.00</span> MZLx</div>
            <div>Token Balance: <span id="tokenBalance">0.00</span> MZLx</div>
        </div>
        <button id="upgradeBtn">Upgrade to Gold Miner</button>
    </div>

    <!-- ICO Countdown -->
    <div class="card">
        <h2>Private Sale ICO</h2>
        <div id="countdown">120 days 00:00:00</div>
        <button id="icoBtn">Participate in ICO</button>
    </div>

    <!-- Token Swap -->
    <div class="card">
        <h2>Token Swap</h2>
        <div class="swap-container">
            <select id="fromToken">
                <option value="MZLx">MZLx</option>
                <option value="USDT">USDT</option>
                <option value="NGN">NGN</option>
            </select>
            <input type="number" id="fromAmount" placeholder="Amount">
            
            <select id="toToken">
                <option value="USDT">USDT</option>
                <option value="MZLx">MZLx</option>
                <option value="NGN">NGN</option>
            </select>
            <input type="text" id="toAmount" placeholder="Result" readonly>
        </div>
        <button id="swapBtn">Swap Tokens</button>
    </div>

    <!-- Voting Section -->
    <div class="card">
        <h2>Token Price Voting</h2>
        <div>Current Price: $<span id="currentPrice">0.001</span></div>
        <input type="range" id="priceSlider" min="0.4" max="3.0" step="0.01" value="0.4">
        <div>Proposed Price: $<span id="proposedPrice">0.40</span></div>
        <button id="voteBtn">Submit Vote</button>
        <div id="votingStatus">Voting closed. Opens 6-11:30 PM WAT</div>
    </div>

    <!-- Deposit Section -->
    <div class="card">
        <h2>Deposit Funds</h2>
        <div>
            <label>Amount (NGN):</label>
            <input type="number" id="depositAmount" min="1000" value="1000">
        </div>
        <div>
            <label>Payment Method:</label>
            <select id="paymentMethod">
                <option value="bank_transfer">Bank Transfer</option>
                <option value="card">Card Payment</option>
            </select>
        </div>
        <button id="depositBtn">Deposit Funds</button>
        <div id="manualDeposit" class="hidden">
            <p>Make transfer to:</p>
            <p>Bank: ECOMAS Bank</p>
            <p>Account: 1234567890</p>
            <p>Reference: <span id="refNumber"></span></p>
            <button id="confirmDeposit">Confirm Deposit</button>
        </div>
    </div>

    <!-- Voice Chat Feature -->
    <div class="card">
        <h2>Voice Messages</h2>
        <button id="recordBtn">Start Recording</button>
        <button id="stopBtn" disabled>Stop Recording</button>
        <audio id="audioPlayback" controls class="hidden"></audio>
        <div id="vulgarWarning" style="color:red; display:none;">Warning: Vulgar language detected!</div>
        
        <div style="margin-top:15px;">
            <input type="text" id="messageRecipient" placeholder="Recipient Address">
            <button id="sendVoiceBtn">Send Voice Message</button>
        </div>
    </div>

    <!-- Affiliate Program -->
    <div class="card">
        <h2>Affiliate Program</h2>
        <div>Your Referral Code: <strong id="referralCode"></strong></div>
        <div>Share this link: <span id="referralLink"></span></div>
        
        <div style="margin-top:15px;">
            <h3>Your Downline</h3>
            <ul id="downlineList"></ul>
        </div>
    </div>

    <!-- Escrow System -->
    <div class="card">
        <h2>Escrow Transactions</h2>
        <div>
            <h3>Create Escrow</h3>
            <input type="text" id="escrowRecipient" placeholder="Recipient Address">
            <input type="number" id="escrowAmount" placeholder="Amount (MZLx)">
            <textarea id="escrowTerms" placeholder="Transaction terms"></textarea>
            <button id="createEscrowBtn">Create Escrow</button>
        </div>
        
        <div style="margin-top:15px;">
            <h3>Your Escrows</h3>
            <table>
                <thead>
                    <tr>
                        <th>Recipient</th>
                        <th>Amount</th>
                        <th>Status</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="escrowList"></tbody>
            </table>
        </div>
    </div>

    <!-- PIN Protection -->
    <div class="card" id="pinSection">
        <h2>Wallet Security</h2>
        <div>Set up a 4-digit PIN</div>
        <input type="password" id="pinInput" maxlength="4" placeholder="0000">
        <button id="setPinBtn">Set PIN</button>
        <button id="lockWalletBtn">Lock Wallet</button>
    </div>

    <!-- Power Member Registration -->
    <div class="card">
        <h2>Power Member Upgrade</h2>
        <p>Pay â‚¦1000 to become a Power Member and get:</p>
        <ul>
            <li>2.5% bonus in MZLx tokens</li>
            <li>Higher mining rates</li>
            <li>Priority support</li>
        </ul>
        <button id="upgradePowerBtn">Become Power Member</button>
    </div>

    <script>
        // =====================
        // CONFIGURATION - REPLACE THESE VALUES
        // =====================
        const MAZOL_CONTRACT_ADDRESS = "0x49F4a728BD98480E92dBfc6a82d595DA9d1F7b83";
        const MONGODB_URI = "mongodb+srv://masolites:YOUR_PASSWORD@ecomas.jrnvjrb.mongodb.net/ECOM?retryWrites=true&w=majority&appName=ECOMAS";
        const FLW_PUBLIC_KEY = "YOUR_FLUTTERWAVE_PUBLIC_KEY";
        const ADMIN_PIN = "1474";
        
        // =====================
        // INITIALIZATION
        // =====================
        const sdk = new ThirdwebSDK("binance");
        let mazolContract;
        let userAddress = "";
        let miningInterval;
        let db;
        let mediaRecorder;
        let audioChunks = [];
        const VULGAR_WORDS = ["fuck", "shit", "asshole", "bitch"]; // Add your list

        async function init() {
            // Connect to MongoDB
            const client = new MongoClient(MONGODB_URI);
            await client.connect();
            db = client.db("ECOM");
            console.log("Connected to MongoDB");
            
            // Initialize contract
            mazolContract = await sdk.getContract(MAZOL_CONTRACT_ADDRESS);
            
            // Set up wallet connection
            document.getElementById('connectWalletBtn').addEventListener('click', connectWallet);
            
            // Set up other event listeners
            document.getElementById('upgradeBtn').addEventListener('click', upgradeToGold);
            document.getElementById('icoBtn').addEventListener('click', participateICO);
            document.getElementById('swapBtn').addEventListener('click', swapTokens);
            document.getElementById('voteBtn').addEventListener('click', submitVote);
            document.getElementById('priceSlider').addEventListener('input', updateProposedPrice);
            document.getElementById('depositBtn').addEventListener('click', processDeposit);
            document.getElementById('confirmDeposit').addEventListener('click', confirmManualDeposit);
            document.getElementById('recordBtn').addEventListener('click', startRecording);
            document.getElementById('stopBtn').addEventListener('click', stopRecording);
            document.getElementById('sendVoiceBtn').addEventListener('click', sendVoiceMessage);
            document.getElementById('createEscrowBtn').addEventListener('click', createEscrow);
            document.getElementById('setPinBtn').addEventListener('click', setPin);
            document.getElementById('lockWalletBtn').addEventListener('click', lockWallet);
            document.getElementById('upgradePowerBtn').addEventListener('click', upgradeToPowerMember);
            
            // Initialize countdown
            startCountdown(120); // 120 days countdown
            
            // Initialize voting status
            checkVotingStatus();
        }

        // =====================
        // WALLET CONNECTION
        // =====================
        async function connectWallet() {
            try {
                const accounts = await ethereum.request({ method: 'eth_requestAccounts' });
                userAddress = accounts[0];
                document.getElementById('walletStatus').textContent = `Connected: ${userAddress.substring(0,6)}...${userAddress.substring(userAddress.length-4)}`;
                
                // Save/load user data
                const user = await loadUserData();
                
                // Start mining
                startMining(user);
                
                // Update UI
                updateUI(user);
                
                // Load additional data
                loadEscrows();
                initAffiliate(user);
            } catch (error) {
                console.error("Wallet connection failed:", error);
                document.getElementById('walletStatus').textContent = "Connection failed";
            }
        }

        // =====================
        // USER MANAGEMENT
        // =====================
        async function loadUserData() {
            let user = await db.collection("users").findOne({ address: userAddress });
            
            if (!user) {
                // Create new user
                user = {
                    address: userAddress,
                    minerStatus: "silver",
                    joinedAt: new Date(),
                    referralCode: generateReferralCode(),
                    affiliateRewards: 0,
                    isPowerMember: false
                };
                await db.collection("users").insertOne(user);
            }
            
            return user;
        }
        
        function generateReferralCode() {
            return Math.random().toString(36).substring(2, 10).toUpperCase();
        }
        
        function updateUI(user) {
            // Update miner status
            const minerStatus = document.getElementById('minerStatus');
            minerStatus.textContent = user.isPowerMember ? "ðŸ’Ž Power Member" : 
                                    user.minerStatus === "gold" ? "ðŸ¥‡ Gold Miner" : "ðŸ¥ˆ Silver Miner";
            minerStatus.className = "miner-badge " + 
                (user.isPowerMember ? "power" : user.minerStatus === "gold" ? "gold" : "silver");
            
            // Update mining rate
            document.getElementById('miningRate').textContent = 
                user.isPowerMember ? "0.075" : user.minerStatus === "gold" ? "0.05" : "0.01";
            
            // Update referral link
            document.getElementById('referralCode').textContent = user.referralCode;
            document.getElementById('referralLink').textContent = 
                `https://masolites.github.io/ecom?ref=${user.referralCode}`;
        }

        // =====================
        // MINING SYSTEM
        // =====================
        function startMining(user) {
            if (miningInterval) clearInterval(miningInterval);
            
            miningInterval = setInterval(async () => {
                // Get mining rate based on status
                const baseRate = user.isPowerMember ? 0.075 : 
                                user.minerStatus === "gold" ? 0.05 : 0.01;
                
                // Calculate tokens to mine
                const tokensToMine = baseRate * getEngagementMultiplier();
                
                // Update UI
                const minedElement = document.getElementById('minedTokens');
                const balanceElement = document.getElementById('tokenBalance');
                
                const minedValue = (parseFloat(minedElement.textContent) + tokensToMine).toFixed(4);
                const balanceValue = (parseFloat(balanceElement.textContent) + tokensToMine).toFixed(4);
                
                minedElement.textContent = minedValue;
                balanceElement.textContent = balanceValue;
                
                // Save to database
                await db.collection("mining_records").insertOne({
                    address: userAddress,
                    amount: tokensToMine,
                    timestamp: new Date()
                });
            }, 60000); // Every minute
        }
        
        function getEngagementMultiplier() {
            // Implement engagement multiplier logic
            return 1; // Base multiplier
        }

        // =====================
        // ICO COUNTDOWN
        // =====================
        function startCountdown(days) {
            const endDate = new Date();
            endDate.setDate(endDate.getDate() + days);
            
            const countdownElement = document.getElementById('countdown');
            
            const timer = setInterval(() => {
                const now = new Date().getTime();
                const distance = endDate - now;
                
                if (distance < 0) {
                    clearInterval(timer);
                    countdownElement.textContent = "ICO Ended!";
                    return;
                }
                
                const days = Math.floor(distance / (1000 * 60 * 60 * 24));
                const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((distance % (1000 * 60)) / 1000);
                
                countdownElement.textContent = `${days}d ${hours}h ${minutes}m ${seconds}s`;
            }, 1000);
        }

        // =====================
        // TOKEN SWAP
        // =====================
        async function swapTokens() {
            const fromToken = document.getElementById('fromToken').value;
            const toToken = document.getElementById('toToken').value;
            const amount = parseFloat(document.getElementById('fromAmount').value);
            
            if (!amount || amount <= 0) {
                alert("Please enter a valid amount");
                return;
            }
            
            // Apply 1% burn fee
            const burnFee = amount * 0.01;
            const netAmount = amount - burnFee;
            
            // Record burn transaction
            await db.collection("burns").insertOne({
                amount: burnFee,
                timestamp: new Date()
            });
            
            // Save transaction to database
            await db.collection("transactions").insertOne({
                from: userAddress,
                to: "swap",
                fromToken,
                toToken,
                amount: netAmount,
                fee: burnFee,
                timestamp: new Date()
            });
            
            // Show success message
            alert(`Swapped ${netAmount.toFixed(4)} ${fromToken} to ${toToken} (${burnFee.toFixed(4)} burned)`);
            
            // Update balance display
            const balanceElement = document.getElementById('tokenBalance');
            balanceElement.textContent = (parseFloat(balanceElement.textContent) - amount).toFixed(4);
        }

        // =====================
        // PRICE VOTING
        // =====================
        function updateProposedPrice() {
            document.getElementById('proposedPrice').textContent = 
                document.getElementById('priceSlider').value;
        }
        
        async function submitVote() {
            const price = parseFloat(document.getElementById('priceSlider').value);
            
            // Check token balance
            const balance = parseFloat(document.getElementById('tokenBalance').textContent);
            if (balance < 100) {
                alert("You need at least 100 MZLx to vote");
                return;
            }
            
            // Save vote to database
            await db.collection("votes").insertOne({
                address: userAddress,
                price,
                timestamp: new Date()
            });
            
            // Show success message
            alert("Vote submitted successfully!");
        }
        
        function checkVotingStatus() {
            const now = new Date();
            const nigeriaTime = now.getUTCHours() + 1; // WAT is UTC+1
            
            // Voting open 6PM-11:30PM Nigeria time
            if (nigeriaTime >= 18 && nigeriaTime < 23.5) {
                document.getElementById('votingStatus').textContent = "Voting open!";
                document.getElementById('votingStatus').style.color = "green";
            } else {
                document.getElementById('votingStatus').textContent = "Voting closed. Opens 6-11:30 PM WAT";
                document.getElementById('votingStatus').style.color = "red";
            }
            
            // Check every minute
            setTimeout(checkVotingStatus, 60000);
        }

        // =====================
        // DEPOSIT SYSTEM
        // =====================
        async function processDeposit() {
            const amount = document.getElementById('depositAmount').value;
            const method = document.getElementById('paymentMethod').value;
            
            if(method === 'bank_transfer') {
                // Generate reference
                const ref = 'ECOM-' + Date.now();
                document.getElementById('refNumber').textContent = ref;
                document.getElementById('manualDeposit').classList.remove('hidden');
                
                // Save to pending deposits
                await db.collection("deposits").insertOne({
                    userId: userAddress,
                    amount: parseFloat(amount),
                    currency: "NGN",
                    reference: ref,
                    status: "pending",
                    timestamp: new Date()
                });
            } else {
                // Card payment with Flutterwave
                FlutterwaveCheckout({
                    public_key: FLW_PUBLIC_KEY,
                    tx_ref: "ECOM-" + Date.now(),
                    amount: amount,
                    currency: "NGN",
                    payment_options: "card",
                    customer: {
                        email: "user@example.com",
                        name: userAddress.substring(0,6) + '...'
                    },
                    callback: function(response) {
                        if(response.status === "successful") {
                            // Save successful deposit
                            db.collection("deposits").insertOne({
                                userId: userAddress,
                                amount: parseFloat(amount),
                                currency: "NGN",
                                reference: response.transaction_id,
                                status: "approved",
                                timestamp: new Date()
                            });
                            
                            // Credit user
                            creditUserAccount(amount, "NGN");
                            alert("Deposit successful!");
                        }
                    }
                });
            }
        }
        
        async function confirmManualDeposit() {
            const ref = document.getElementById('refNumber').textContent;
            alert("Deposit confirmation sent to admin for approval");
            document.getElementById('manualDeposit').classList.add('hidden');
        }
        
        async function creditUserAccount(amount, currency) {
            // Update user balance in MongoDB
            await db.collection("wallets").updateOne(
                { userId: userAddress },
                { $inc: { [currency]: parseFloat(amount) } },
                { upsert: true }
            );
            
            // Update UI
            document.getElementById('tokenBalance').textContent = 
                (parseFloat(document.getElementById('tokenBalance').textContent) + 
                parseFloat(amount)).toFixed(2);
        }

        // =====================
        // VOICE MESSAGING
        // =====================
        async function startRecording() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                mediaRecorder = new MediaRecorder(stream);
                audioChunks = [];
                
                mediaRecorder.ondataavailable = event => {
                    audioChunks.push(event.data);
                };
                
                mediaRecorder.onstop = () => {
                    const audioBlob = new Blob(audioChunks, { type: 'audio/wav' });
                    const audioUrl = URL.createObjectURL(audioBlob);
                    document.getElementById('audioPlayback').src = audioUrl;
                    document.getElementById('audioPlayback').classList.remove('hidden');
                };
                
                mediaRecorder.start();
                document.getElementById('recordBtn').disabled = true;
                document.getElementById('stopBtn').disabled = false;
            } catch (error) {
                console.error("Recording failed:", error);
                alert("Microphone access required for voice messages");
            }
        }
        
        function stopRecording() {
            mediaRecorder.stop();
            document.getElementById('recordBtn').disabled = false;
            document.getElementById('stopBtn').disabled = true;
        }
        
        async function sendVoiceMessage() {
            const recipient = document.getElementById('messageRecipient').value;
            const audioBlob = new Blob(audioChunks, { type: 'audio/wav' });
            
            // Convert to base64
            const reader = new FileReader();
            reader.readAsDataURL(audioBlob);
            reader.onloadend = async () => {
                const base64Audio = reader.result;
                
                // Check for vulgar words (simulated)
                const containsVulgar = await checkForVulgar(base64Audio);
                
                if(containsVulgar) {
                    document.getElementById('vulgarWarning').style.display = 'block';
                    return;
                }
                
                // Save to database
                await db.collection("voice_messages").insertOne({
                    sender: userAddress,
                    recipient,
                    audio: base64Audio,
                    timestamp: new Date(),
                    isFiltered: false
                });
                
                alert("Voice message sent!");
            };
        }
        
        // Simulated vulgar word detection
        async function checkForVulgar(audioData) {
            // In real implementation, send to AI API
            return false; // Simulate no vulgar words
        }

        // =====================
        // AFFILIATE PROGRAM
        // =====================
        async function initAffiliate(user) {
            // Update UI
            document.getElementById('referralCode').textContent = user.referralCode;
            document.getElementById('referralLink').textContent = 
                `https://masolites.github.io/ecom?ref=${user.referralCode}`;
            
            // Load downline
            const downline = user.downline || [];
            const downlineList = document.getElementById('downlineList');
            downlineList.innerHTML = '';
            
            downline.forEach(address => {
                const li = document.createElement('li');
                li.textContent = address.substring(0,10) + '...';
                downlineList.appendChild(li);
            });
        }

        // =====================
        // ESCROW SYSTEM
        // =====================
        async function createEscrow() {
            const recipient = document.getElementById('escrowRecipient').value;
            const amount = parseFloat(document.getElementById('escrowAmount').value);
            const terms = document.getElementById('escrowTerms').value;
            
            // Create escrow
            await db.collection("escrows").insertOne({
                sender: userAddress,
                recipient,
                amount,
                terms,
                status: "pending",
                timestamp: new Date()
            });
            
            alert("Escrow created successfully!");
            loadEscrows();
        }
        
        async function loadEscrows() {
            const escrows = await db.collection("escrows")
                .find({ $or: [{ sender: userAddress }, { recipient: userAddress }] })
                .toArray();
            
            const escrowList = document.getElementById('escrowList');
            escrowList.innerHTML = '';
            
            escrows.forEach(escrow => {
                const row = escrowList.insertRow();
                row.insertCell(0).textContent = escrow.recipient.substring(0,10) + '...';
                row.insertCell(1).textContent = escrow.amount;
                row.insertCell(2).textContent = escrow.status;
                
                const actionCell = row.insertCell(3);
                if(escrow.status === "pending" && userAddress === escrow.recipient) {
                    const releaseBtn = document.createElement('button');
                    releaseBtn.textContent = 'Release';
                    releaseBtn.onclick = () => releaseEscrow(escrow._id);
                    actionCell.appendChild(releaseBtn);
                    
                    const disputeBtn = document.createElement('button');
                    disputeBtn.textContent = 'Dispute';
                    disputeBtn.onclick = () => disputeEscrow(escrow._id);
                    disputeBtn.style.marginLeft = '5px';
                    actionCell.appendChild(disputeBtn);
                }
            });
        }
        
        async function releaseEscrow(escrowId) {
            await db.collection("escrows").updateOne(
                { _id: escrowId },
                { $set: { status: "completed" } }
            );
            
            // Transfer tokens (simulated)
            alert("Escrow released! Tokens transferred.");
            loadEscrows();
        }
        
        async function disputeEscrow(escrowId) {
            await db.collection("escrows").updateOne(
                { _id: escrowId },
                { $set: { status: "disputed" } }
            );
            
            alert("Escrow disputed! Admin will review.");
            loadEscrows();
        }

        // =====================
        // PIN PROTECTION
        // =====================
        async function setPin() {
            const pin = document.getElementById('pinInput').value;
            if(pin.length !== 4) {
                alert("PIN must be 4 digits");
                return;
            }
            
            // Save PIN to database
            await db.collection("users").updateOne(
                { address: userAddress },
                { $set: { pin } },
                { upsert: true }
            );
            
            alert("PIN set successfully!");
        }
        
        function lockWallet() {
            userAddress = "";
            document.getElementById('walletStatus').textContent = "Wallet locked";
            alert("Wallet locked. Reconnect to access.");
        }

        // =====================
        // POWER MEMBER UPGRADE
        // =====================
        async function upgradeToPowerMember() {
            // Process payment through Flutterwave
            FlutterwaveCheckout({
                public_key: FLW_PUBLIC_KEY,
                tx_ref: "POWER-" + Date.now(),
                amount: 1000,
                currency: "NGN",
                payment_options: "card, banktransfer",
                customer: {
                    email: "user@example.com",
                    name: userAddress.substring(0,6) + '...'
                },
                callback: async function(response) {
                    if(response.status === "successful") {
                        // Update user status
                        await db.collection("users").updateOne(
                            { address: userAddress },
                            { $set: { isPowerMember: true } }
                        );
                        
                        // Award bonus tokens (2.5% of 1000 NGN at current rate)
                        const bonusTokens = 25; // Calculation based on token price
                        await db.collection("transactions").insertOne({
                            userId: userAddress,
                            type: "power_bonus",
                            amount: bonusTokens,
                            currency: "MZLx",
                            timestamp: new Date()
                        });
                        
                        // Update UI
                        document.getElementById('minerStatus').textContent = "ðŸ’Ž Power Member";
                        document.getElementById('minerStatus').className = "miner-badge power";
                        document.getElementById('miningRate').textContent = "0.075";
                        
                        // Update token balance
                        const balanceElement = document.getElementById('tokenBalance');
                        balanceElement.textContent = (parseFloat(balanceElement.textContent) + bonusTokens).toFixed(4);
                        
                        alert(`Power membership activated! ${bonusTokens} MZLx bonus awarded`);
                    }
                }
            });
        }

        // =====================
        // HELPER FUNCTIONS
        // =====================
        async function upgradeToGold() {
            // Update user status in database
            await db.collection("users").updateOne(
                { address: userAddress },
                { $set: { minerStatus: "gold" } }
            );
            
            // Update UI
            document.getElementById('minerStatus').textContent = "ðŸ¥‡ Gold Miner";
            document.getElementById('minerStatus').className = "miner-badge gold";
            document.getElementById('miningRate').textContent = "0.05";
        }
        
        async function participateICO() {
            // Implement ICO participation
            alert("Redirecting to ICO participation...");
        }

        // Initialize the app
        window.addEventListener('load', init);
    </script>
</body>
</html>
